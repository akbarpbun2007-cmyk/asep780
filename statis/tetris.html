<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Tetris Neon</title>
<style>
:root{
  --cell:28px;--cols:10;--rows:20;
  --neon:#00eaff;
}
html,body{
  height:100%;margin:0;font-family:'Orbitron',system-ui,Arial;
  background:radial-gradient(circle at top,#091532 0%,#000618 80%);
  color:#e6eef8;overflow:hidden;
}
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');
.wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:20px}
.board{display:grid;grid-template-columns:1fr 260px;gap:20px;align-items:start}
.game{
  background:rgba(6,16,40,0.8);padding:12px;border-radius:12px;
  box-shadow:0 0 20px rgba(0,234,255,.3);position:relative;
  border:2px solid rgba(0,234,255,0.2);backdrop-filter:blur(6px);
}
canvas#tetris{
  background:linear-gradient(180deg,#021030,#000616);
  border:2px solid var(--neon);
  box-shadow:0 0 20px rgba(0,234,255,0.3) inset,0 0 10px rgba(0,234,255,0.3);
  border-radius:8px;display:block;transition:all .3s ease;
}
.overlay{
  position:absolute;left:12px;top:12px;width:calc(100% - 24px);height:calc(100% - 24px);
  display:flex;align-items:center;justify-content:center;pointer-events:none;
  animation:fadeIn .4s ease;
}
.overlay .box{
  background:rgba(0,10,20,0.8);
  border:1px solid var(--neon);
  box-shadow:0 0 20px rgba(0,234,255,0.5);
  padding:20px;border-radius:10px;text-align:center;color:#dff0ff;
  pointer-events:auto;animation:pop .4s ease;
}
.overlay h2{margin:0 0 8px;font-size:20px;color:var(--neon)}
.overlay p{margin:0 0 12px;color:#aeeaff}
.overlay button{
  cursor:pointer;background:var(--neon);border:none;color:#001028;
  padding:8px 14px;border-radius:6px;font-weight:bold;transition:.2s;
}
.overlay button:hover{background:#fff;color:#000}
.side{width:260px}
h1{font-size:20px;margin:0 0 8px;color:var(--neon);text-shadow:0 0 6px var(--neon)}
.panel{
  background:linear-gradient(180deg,#071733,#032033);
  padding:12px;border-radius:10px;margin-bottom:12px;
  border:1px solid rgba(0,234,255,0.15);color:#cfe8ff;
  box-shadow:0 0 10px rgba(0,234,255,0.1);
}
.small{font-size:13px;color:#9fc6ff}
button{background:#0b2640;border:1px solid rgba(255,255,255,0.08);color:#dff0ff;padding:8px 10px;border-radius:8px;transition:.2s}
button:hover{background:var(--neon);color:#000}
.hint{font-size:13px;color:#9fb9d6;margin-top:6px}
.next-canvas{background:#041024;border-radius:8px;display:block;margin-top:8px;border:2px solid #555}
footer{font-size:12px;color:#8fb4d9;margin-top:6px;text-align:center}
@keyframes pop{0%{transform:scale(0.7);opacity:0;}100%{transform:scale(1);opacity:1;}}
@keyframes fadeIn{0%{opacity:0;}100%{opacity:1;}}
@media(max-width:720px){
  .board{grid-template-columns:1fr;gap:12px}
  .side{width:100%}
}
</style>
</head>
<body tabindex="0">
  <div class="wrap">
    <div class="board">
      <div class="game">
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px;justify-content:space-between">
          <h1>Tetris Neon</h1>
          <button id="btn-start">Mulai Permainan</button>
        </div>
        <canvas id="tetris" width="280" height="560"></canvas>

        <div id="overlay" class="overlay" style="display:none">
          <div class="box">
            <h2 id="overlay-title">Game Over</h2>
            <p id="overlay-msg">Area penuh ‚Äî permainan selesai.</p>
            <div style="display:flex;gap:8px;justify-content:center">
              <button id="overlay-restart">Restart</button>
              <button id="overlay-close">Tutup</button>
            </div>
          </div>
        </div>

        <div class="hint small">Kontrol: ‚Üê ‚Üí (geser), ‚Üë (rotate), ‚Üì (turun), Space (jatuh cepat), P (pause)</div>
      </div>

      <div class="side">
        <div class="panel">
          <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap">
            <div><div class="small">Skor</div><div id="score" style="font-size:20px">0</div></div>
            <div><div class="small">Level</div><div id="level" style="font-size:20px">1</div></div>
            <div><div class="small">Baris</div><div id="lines" style="font-size:20px">0</div></div>
          </div>
          <div style="margin-top:8px"><div class="small">High Score</div><div id="highscore" style="font-size:18px">0</div></div>
        </div>

        <div class="panel">
          <div class="small">Next</div>
          <canvas id="next" class="next-canvas" width="112" height="112"></canvas>
        </div>

        <div class="panel controls">
          <button id="btn-left">‚Üê</button>
          <button id="btn-rotate">‚Üë</button>
          <button id="btn-right">‚Üí</button>
          <button id="btn-down">‚Üì</button>
          <button id="btn-drop">Space</button>
        </div>

        <div class="panel">
          <button id="btn-pause">Pause</button>
          <button id="btn-restart">Restart</button>
          <button id="btn-sound">üîä Musik</button>
        </div>

        <footer>
          <div>Made with üíô ‚Äî <b>Tetris Neon</b></div>
          <div>(c) 2025 <strong>Ekskul Coding SMAN 2 Pangkalan Bun</strong></div>
        </footer>
      </div>
    </div>
  </div>

<script>
const canvas=document.getElementById('tetris'),ctx=canvas.getContext('2d');
const nextCanvas=document.getElementById('next'),nctx=nextCanvas.getContext('2d');
const overlay=document.getElementById('overlay'),
overlayTitle=document.getElementById('overlay-title'),
overlayMsg=document.getElementById('overlay-msg');
const overlayRestart=document.getElementById('overlay-restart'),
overlayClose=document.getElementById('overlay-close');

const scale=28,COLS=10,ROWS=20;
const colors=[null,'#00ffff','#ff00ff','#ff9900','#ffff00','#00ff00','#ff0077','#00aaff'];
const pieces='IOTSZJL';
const shapes={
  I:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],
  O:[[2,2],[2,2]],
  T:[[0,3,0],[3,3,3],[0,0,0]],
  S:[[0,4,4],[4,4,0],[0,0,0]],
  Z:[[5,5,0],[0,5,5],[0,0,0]],
  J:[[6,0,0],[6,6,6],[0,0,0]],
  L:[[0,0,7],[7,7,7],[0,0,0]]
};
function createMatrix(w,h){const m=[];while(h--)m.push(new Array(w).fill(0));return m;}
let arena=createMatrix(COLS,ROWS);
function drawMatrix(matrix,offset,context,cellSize){
  for(let y=0;y<matrix.length;y++){
    for(let x=0;x<matrix[y].length;x++){
      const val=matrix[y][x];
      if(val){
        context.fillStyle=colors[val];
        context.fillRect((x+offset.x)*cellSize,(y+offset.y)*cellSize,cellSize-1,cellSize-1);
      }
    }
  }
}
function collide(arenaRef,piece){
  const m=piece.matrix;
  for(let y=0;y<m.length;y++){
    for(let x=0;x<m[y].length;x++){
      if(m[y][x]&&(arenaRef[y+piece.pos.y]&&arenaRef[y+piece.pos.y][x+piece.pos.x])!==0)return true;
    }
  }
  return false;
}
function merge(arenaRef,piece){
  piece.matrix.forEach((row,y)=>{
    row.forEach((v,x)=>{if(v)arenaRef[y+piece.pos.y][x+piece.pos.x]=v;});
  });
  playLock();
}
function rotate(m,dir){
  for(let y=0;y<m.length;y++)for(let x=0;x<y;x++) [m[x][y],m[y][x]]=[m[y][x],m[x][y]];
  dir>0?m.forEach(r=>r.reverse()):m.reverse();
}
function createPiece(t){return shapes[t].map(r=>r.slice());}
const player={pos:{x:0,y:0},matrix:null};
let nextPiece={matrix:createPiece(pieces[Math.floor(Math.random()*pieces.length)])};

function showOverlay(t,m,showRestart=true){
  overlayTitle.textContent=t;overlayMsg.textContent=m;overlay.style.display='flex';
  overlayRestart.style.display=showRestart?'inline-block':'none';
}
function hideOverlay(){overlay.style.display='none';}
function spawnNext(){
  player.matrix=nextPiece.matrix.map(r=>r.slice());
  player.pos.y=0;player.pos.x=Math.floor((COLS-player.matrix[0].length)/2);
  nextPiece.matrix=createPiece(pieces[Math.floor(Math.random()*pieces.length)]);
  if(collide(arena,player)){stopGame();showOverlay('Game Over','Area penuh ‚Äî permainan selesai.');}
}
function sweepLines(){
  let rowCount=0;
  outer:for(let y=arena.length-1;y>=0;y--){
    for(let x=0;x<arena[y].length;x++)if(arena[y][x]===0)continue outer;
    const row=arena.splice(y,1)[0].fill(0);
    arena.unshift(row);y++;rowCount++;
  }
  if(rowCount>0){
    const points=[0,40,100,300,1200];
    score+=points[rowCount]*level;lines+=rowCount;
    level=Math.floor(lines/10)+1;
    updateStats();playClear(rowCount);
  }
}

const STORAGE_KEY='tetris_highscore_v2';
let score=0,lines=0,level=1,highscore=0;
function loadHighscore(){highscore=parseInt(localStorage.getItem(STORAGE_KEY)||'0');document.getElementById('highscore').innerText=highscore;}
function saveHighscore(){localStorage.setItem(STORAGE_KEY,highscore);}
function updateStats(){
  document.getElementById('score').innerText=score;
  document.getElementById('level').innerText=level;
  document.getElementById('lines').innerText=lines;
  if(score>highscore){highscore=score;saveHighscore();document.getElementById('highscore').innerText=highscore;}
}

let dropCounter=0,dropInterval=1000,lastTime=0,paused=false,running=false;
function update(time=0){
  if(!running)return;
  if(paused){lastTime=time;requestAnimationFrame(update);return;}
  const delta=time-lastTime;lastTime=time;dropCounter+=delta;
  dropInterval=Math.max(100,1000-(level-1)*70);
  if(dropCounter>dropInterval){
    player.pos.y++;
    if(collide(arena,player)){player.pos.y--;merge(arena,player);sweepLines();spawnNext();}
    dropCounter=0;
  }
  draw();requestAnimationFrame(update);
}
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  nctx.clearRect(0,0,nextCanvas.width,nextCanvas.height);
  drawMatrix(arena,{x:0,y:0},ctx,scale);
  if(player.matrix)drawMatrix(player.matrix,player.pos,ctx,scale);
  const nextMatrix=nextPiece.matrix,nx=Math.floor((4-nextMatrix[0].length)/2);
  drawMatrix(nextMatrix,{x:nx,y:1},nctx,28);
}
function startGame(){
  arena=createMatrix(COLS,ROWS);score=0;lines=0;level=1;dropCounter=0;paused=false;
  hideOverlay();loadHighscore();spawnNext();updateStats();
  if(!running){running=true;requestAnimationFrame(update);}
}
function stopGame(){running=false;}

// Controls
function keyHandler(e){
  if(!running)return;
  ensureAudio();
  if(e.key==='ArrowLeft'){player.pos.x--;if(collide(arena,player))player.pos.x++;}
  else if(e.key==='ArrowRight'){player.pos.x++;if(collide(arena,player))player.pos.x--;}
  else if(e.key==='ArrowDown'){player.pos.y++;if(collide(arena,player)){player.pos.y--;merge(arena,player);sweepLines();spawnNext();}dropCounter=0;}
  else if(e.key==='ArrowUp'){rotate(player.matrix,1);if(collide(arena,player))rotate(player.matrix,-1);}
  else if(e.code==='Space'){e.preventDefault();while(!collide(arena,player))player.pos.y++;player.pos.y--;merge(arena,player);sweepLines();spawnNext();dropCounter=0;}
  else if(e.key.toLowerCase()==='p'){togglePause();}
}
window.addEventListener('keydown',keyHandler);
function togglePause(){paused=!paused;document.getElementById('btn-pause').innerText=paused?'Resume':'Pause';}

document.getElementById('btn-left').onclick=()=>keyHandler({key:'ArrowLeft'});
document.getElementById('btn-right').onclick=()=>keyHandler({key:'ArrowRight'});
document.getElementById('btn-rotate').onclick=()=>keyHandler({key:'ArrowUp'});
document.getElementById('btn-down').onclick=()=>keyHandler({key:'ArrowDown'});
document.getElementById('btn-drop').onclick=()=>keyHandler({code:'Space'});
document.getElementById('btn-pause').onclick=togglePause;
document.getElementById('btn-restart').onclick=startGame;
document.getElementById('btn-start').onclick=()=>{
  document.getElementById('btn-start').style.display='none';
  startGame();playMusic();
};
overlayRestart.onclick=()=>{startGame();};
overlayClose.onclick=()=>hideOverlay();

// Audio
const AudioCtx=window.AudioContext||window.webkitAudioContext;
let audioCtx=null,bgMusic=null;
function ensureAudio(){if(!audioCtx){audioCtx=new AudioCtx();}}
function playLock(){
  if(!audioCtx)return;
  const now=audioCtx.currentTime;
  const osc=audioCtx.createOscillator();const gain=audioCtx.createGain();
  osc.type='sine';osc.frequency.setValueAtTime(220,now);
  gain.gain.setValueAtTime(0.1,now);gain.gain.exponentialRampToValueAtTime(0.001,now+0.2);
  osc.connect(gain);gain.connect(audioCtx.destination);osc.start(now);osc.stop(now+0.25);
}
function playClear(lines){
  if(!audioCtx)return;
  const now=audioCtx.currentTime;
  const osc=audioCtx.createOscillator();const gain=audioCtx.createGain();
  osc.type='square';osc.frequency.setValueAtTime(400+lines*80,now);
  gain.gain.setValueAtTime(0.1,now);gain.gain.exponentialRampToValueAtTime(0.001,now+0.3);
  osc.connect(gain);gain.connect(audioCtx.destination);osc.start(now);osc.stop(now+0.3);
}
function playMusic(){
  if(bgMusic)return;
  const audio=document.createElement('audio');
  audio.src='https://cdn.pixabay.com/download/audio/2022/03/15/audio_6b548fe74f.mp3?filename=retro-game-music-10302.mp3';
  audio.loop=true;audio.volume=0.3;
  document.body.appendChild(audio);
  bgMusic=audio;
  audio.play().catch(()=>{});
}
document.getElementById('btn-sound').onclick=()=>{
  if(bgMusic){
    if(bgMusic.paused){bgMusic.play();document.getElementById('btn-sound').innerText='üîä Musik';}
    else{bgMusic.pause();document.getElementById('btn-sound').innerText='üîá Musik';}
  }else playMusic();
};
</script>
</body>
</html>
