
        <div style="display:flex;justify-content:space-between">
          <div><div class="small">Skor</div><div id="score">0</div></div>
          <div><div class="small">Level</div><div id="level">1</div></div>
          <div><div class="small">Baris</div><div id="lines">0</div></div>
        </div>
        <div style="margin-top:10px"><div class="small">High Score</div><div id="highscore">0</div></div>
        <div style="margin-top:10px"><div class="small">Waktu</div><div id="timer">60</div></div>
      </div>
      <footer>Â© 2025 Neo Blast by Ekskul Coding</footer>
    </div>
  </div>
</div>

<script>
/* ==== Variabel Dasar ==== */
const cvs=document.getElementById("tetris"),ctx=cvs.getContext("2d");
const scale=28,COLS=10,ROWS=20;
let arena,player,nextPiece,score=0,lines=0,level=1,highscore=0;
let running=false,paused=false,lastTime=0,dropCounter=0,dropInterval=1000;
let timer=60,timerInt=null;
const colors=[null,'#00f0f0','#5b6cff','#f0a000','#f5f050','#00ff88','#c57eff','#ff6b6b'];
const shapes={I:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],O:[[2,2],[2,2]],T:[[0,3,0],[3,3,3],[0,0,0]],S:[[0,4,4],[4,4,0],[0,0,0]],Z:[[5,5,0],[0,5,5],[0,0,0]],J:[[6,0,0],[6,6,6],[0,0,0]],L:[[0,0,7],[7,7,7],[0,0,0]]};
const pieces='IOTSZJL';
function createMatrix(w,h){const m=[];while(h--)m.push(new Array(w).fill(0));return m;}
function createPiece(t){return shapes[t].map(r=>r.slice());}

/* ==== Gambar ==== */
function drawMatrix(matrix,offset){
  for(let y=0;y<matrix.length;y++)
    for(let x=0;x<matrix[y].length;x++)
      if(matrix[y][x]){
        ctx.fillStyle=colors[matrix[y][x]];
        ctx.shadowColor=colors[matrix[y][x]];
        ctx.shadowBlur=10;
        ctx.fillRect((x+offset.x)*scale,(y+offset.y)*scale,scale-1,scale-1);
        ctx.shadowBlur=0;
      }
}
function draw(){
  ctx.clearRect(0,0,cvs.width,cvs.height);
  drawMatrix(arena,{x:0,y:0});
  drawMatrix(player.matrix,player.pos);
}

/* ==== Arena & Player ==== */
function collide(arena,p){const m=p.matrix;for(let y=0;y<m.length;y++)for(let x=0;x<m[y].length;x++)if(m[y][x]&&(arena[y+p.pos.y]&&arena[y+p.pos.y][x+p.pos.x])!==0)return true;return false;}
function merge(arena,p){p.matrix.forEach((row,y)=>row.forEach((v,x)=>{if(v)arena[y+p.pos.y][x+p.pos.x]=v;}));playLock();}
function rotate(m,dir){for(let y=0;y<m.length;y++)for(let x=0;x<y;x++)[m[x][y],m[y][x]]=[m[y][x],m[x][y]];dir>0?m.forEach(r=>r.reverse()):m.reverse();}

/* ==== Partikel & Efek ==== */
const pcanvas=document.getElementById("particles"),pctx=pcanvas.getContext("2d");pcanvas.width=cvs.width;pcanvas.height=cvs.height;
let particles=[];
function makeParticles(y,color){for(let i=0;i<30;i++)particles.push({x:Math.random()*cvs.width,y:y*scale+Math.random()*10,vx:(Math.random()-0.5)*3,vy:(Math.random()-1.2)*3,life:500+Math.random()*500,col:color,age:0});}
function updateParticles(dt){pctx.clearRect(0,0,pcanvas.width,pcanvas.height);particles=particles.filter(p=>{p.age+=dt;if(p.age>p.life)return false;p.vy+=0.04;p.x+=p.vx;p.y+=p.vy;pctx.globalAlpha=1-p.age/p.life;pctx.fillStyle=p.col;pctx.beginPath();pctx.arc(p.x,p.y,2,0,2*Math.PI);pctx.fill();return true});pctx.globalAlpha=1;}

/* ==== Baris ==== */
function clearLines(){
  let rowCount=0;
  for(let y=arena.length-1;y>=0;y--){
    if(arena[y].every(v=>v!==0)){
      const color=colors[arena[y][0]];
      arena.splice(y,1);
      arena.unshift(new Array(COLS).fill(0));
      makeParticles(y,color);
      y++;rowCount++;
    }
  }
  if(rowCount>0){score+=rowCount*100;lines+=rowCount;level=Math.floor(lines/10)+1;updateStats();playLine();}
}

/* ==== Statistik ==== */
function updateStats(){
  document.getElementById("score").innerText=score;
  document.getElementById("lines").innerText=lines;
  document.getElementById("level").innerText=level;
  if(score>highscore){highscore=score;localStorage.setItem("tetris_neoblast_hs",highscore);}
  document.getElementById("highscore").innerText=highscore;
}

/* ==== Timer ==== */
function startTimer(){
  clearInterval(timerInt);
  timer=60;document.getElementById("timer").innerText=timer;
  timerInt=setInterval(()=>{
    if(!running||paused)return;
    timer--;
    document.getElementById("timer").innerText=timer;
    if(timer<=0){clearInterval(timerInt);endGame("Waktu Habis!","Permainan berakhir.<br>Skor akhir: "+score);}
  },1000);
}

/* ==== Game Loop ==== */
function update(time=0){
  if(!running)return;
  const delta=time-lastTime;lastTime=time;
  if(!paused){
    dropCounter+=delta;
    if(dropCounter>dropInterval){
      player.pos.y++;
      if(collide(arena,player)){player.pos.y--;merge(arena,player);clearLines();spawn();dropCounter=0;}
      dropCounter=0;
    }
  }
  draw();updateParticles(delta);
  requestAnimationFrame(update);
}

/* ==== Game Control ==== */
function spawn(){
  player.matrix=nextPiece.matrix.map(r=>r.slice());
  player.pos.y=0;
  player.pos.x=(COLS-player.matrix[0].length)/2|0;
  nextPiece={matrix:createPiece(pieces[Math.floor(Math.random()*pieces.length)])};
  if(collide(arena,player))endGame("Game Over","Area penuh â€” permainan selesai!");
}
function startGame(){
  arena=createMatrix(COLS,ROWS);
  player={pos:{x:0,y:0},matrix:createPiece(pieces[Math.floor(Math.random()*pieces.length)])};
  nextPiece={matrix:createPiece(pieces[Math.floor(Math.random()*pieces.length)])};
  score=0;lines=0;level=1;paused=false;running=true;dropCounter=0;updateStats();hideOverlay();
  startTimer();playBGM();requestAnimationFrame(update);
}
function endGame(title,msg){
  running=false;paused=false;clearInterval(timerInt);
  stopBGM();document.getElementById("ov-title").innerText=title;
  document.getElementById("ov-msg").innerHTML=msg;
  document.getElementById("overlay").style.display="flex";
}
function hideOverlay(){document.getElementById("overlay").style.display="none";}

/* ==== Audio ==== */
let audioCtx=null;
function initAudio(){if(!audioCtx){try{audioCtx=new (window.AudioContext||window.webkitAudioContext)();}catch(e){}}}
function playLock(){if(!audioCtx)return;const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.type="sine";o.frequency.value=220;g.gain.value=0.08;o.connect(g);g.connect(audioCtx.destination);o.start();g.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+0.25);o.stop(audioCtx.currentTime+0.3);}
function playLine(){if(!audioCtx)return;const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.type="square";o.frequency.value=400;g.gain.value=0.1;o.connect(g);g.connect(audioCtx.destination);o.start();g.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+0.3);o.stop(audioCtx.currentTime+0.32);}
let bgm=null;const BGM_URL='https://cdn.pixabay.com/download/audio/2022/03/15/audio_6b548fe74f.mp3?filename=retro-game-music-10302.mp3';
function playBGM(){if(bgm)return;bgm=new Audio(BGM_URL);bgm.loop=true;bgm.volume=0.28;bgm.play().catch(()=>{});}
function stopBGM(){if(bgm){bgm.pause();bgm.currentTime=0;bgm=null;}}

/* ==== Event ==== */
window.addEventListener("keydown",e=>{
  if(!running)return;
  initAudio();
  if(e.code==="ArrowLeft"){player.pos.x--;if(collide(arena,player))player.pos.x++;}
  else if(e.code==="ArrowRight"){player.pos.x++;if(collide(arena,player))player.pos.x--;}
  else if(e.code==="ArrowDown"){player.pos.y++;if(collide(arena,player)){player.pos.y--;merge(arena,player);clearLines();spawn();}}
  else if(e.code==="ArrowUp"){rotate(player.matrix,1);if(collide(arena,player))rotate(player.matrix,-1);}
  else if(e.code==="Space"){while(!collide(arena,player))player.pos.y++;player.pos.y--;merge(arena,player);clearLines();spawn();}
  else if(e.key.toLowerCase()==='p'){paused=!paused;}
});

document.getElementById("btn-start").onclick=()=>{initAudio();document.getElementById("btn-start").disabled=true;startGame();};
document.getElementById("ov-restart").onclick=()=>{hideOverlay();startGame();};
document.getElementById("btn-mute").onclick=()=>{if(!bgm){playBGM();return;}if(bgm.paused){bgm.play();document.getElementById("btn-mute").innerText="ðŸ”Š Musik";}else{bgm.pause();document.getElementById("btn-mute").innerText="ðŸ”‡ Mati";}};
window.onclick=()=>initAudio();

/* ==== Init ==== */
arena=createMatrix(COLS,ROWS);
player={pos:{x:0,y:0},matrix:createPiece(pieces[Math.floor(Math.random()*pieces.length)])};
nextPiece={matrix:createPiece(pieces[Math.floor(Math.random()*pieces.length)])};
highscore=parseInt(localStorage.getItem("tetris_neoblast_hs")||"0");
updateStats();draw();
</script>
</body>
</html>
